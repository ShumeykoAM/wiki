<?xml version="1.0" encoding="UTF-8"?>
<topic template="Default" lasteditedby="Kot" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../helpproject.xsd">
  <title translate="true">Ссылочная целостность</title>
  <body>
    <header>
      <para styleclass="Heading1"><text styleclass="Heading1" translate="true">Ссылочная целостность</text></para>
    </header>
    <para styleclass="Normal" style="text-indent:24px; margin-right:0px; margin-left:0px; tabstops:none;"><text styleclass="Normal" translate="true">Что бы </text><text styleclass="Normal" style="color:#ff0000;" translate="true">обеспечить ссылочную целостность</text><text styleclass="Normal" translate="true">, отсутствие рассогласованности БД, отсутствие висячих записей, можно на вторичный ключ навесить ограничения. Но для того что бы в SQLite эти оганичения срабатывали нужно включать соответствующий режим работы СУБД с помощью директивы </text><text styleclass="Normal" style="color:#ff0000;" translate="true">PRAGMA FOREIGN_KEYS=ON;</text></para>
    <para styleclass="Normal" style="text-indent:24px; margin-right:0px; margin-left:0px; tabstops:none;"><text styleclass="Normal" style="color:#000000;" translate="true">Пример:</text></para>
    <para styleclass="Normal" style="text-indent:24px; margin-right:0px; margin-left:0px; tabstops:none;"><text styleclass="Normal" style="color:#000000;" translate="true">создаем таблицы и задаем ограничения вторичного ключа</text></para>
    <para style="background-color:#ebebf7;"><text style="font-family:Consolas; font-size:10pt; font-weight:bold; color:#000080;" translate="true">CREATE TABLE </text><text style="font-family:Consolas; font-size:10pt; color:#000000;" translate="true">t1 (</text><br/><text style="font-family:Consolas; font-size:10pt; color:#000000;" translate="true"> &#160;id </text><text style="font-family:Consolas; font-size:10pt; font-weight:bold; color:#000080;" translate="true">INT PRIMARY KEY</text><br/><text style="font-family:Consolas; font-size:10pt; font-weight:bold; color:#000080;" translate="true"> &#160; &#160;NOT NULL</text><br/><text style="font-family:Consolas; font-size:10pt; color:#000000;" translate="true">);</text><br/><br/><text style="font-family:Consolas; font-size:10pt; font-weight:bold; color:#000080;" translate="true">CREATE TABLE </text><text style="font-family:Consolas; font-size:10pt; color:#000000;" translate="true">t2 (</text><br/><text style="font-family:Consolas; font-size:10pt; color:#000000;" translate="true"> &#160;idt1 </text><text style="font-family:Consolas; font-size:10pt; font-weight:bold; color:#000080;" translate="true">INTEGER REFERENCES </text><text style="font-family:Consolas; font-size:10pt; color:#000000;" translate="true">t1 (id) </text><br/><text style="font-family:Consolas; font-size:10pt; color:#000000;" translate="true"> &#160;</text><text style="font-family:Consolas; font-size:10pt; font-weight:bold; color:#000080;" translate="true">ON DELETE RESTRICT</text><br/><text style="font-family:Consolas; font-size:10pt; font-weight:bold; color:#000080;" translate="true"> &#160;ON UPDATE RESTRICT</text><br/><text style="font-family:Consolas; font-size:10pt; color:#000000;" translate="true">);</text></para>
    <para styleclass="Normal" style="text-indent:23px; margin-right:0px; margin-left:0px; tabstops:none;"><text styleclass="Normal" translate="true">Далее при каждой сессии соединения с СУБД перед манипуляцией с записями нужно делать запрос:</text></para>
    <para styleclass="Normal" style="text-indent:23px; margin-right:0px; margin-left:0px; tabstops:none;"><text styleclass="Normal" style="color:#ff0000;" translate="true">PRAGMA FOREIGN_KEYS=ON;</text></para>
    <para styleclass="Normal" style="text-indent:23px; margin-right:0px; margin-left:0px; tabstops:none;"><text styleclass="Normal" style="color:#000000;" translate="true">Далее можно делать вставку обновление и удаление записей, СУБД проверит на нарушение ссылочной целостности и, в нашем случае, запретит неправильное действие.</text></para>
    <para styleclass="Normal" style="text-indent:23px; margin-right:0px; margin-left:0px; tabstops:none;"><text styleclass="Normal" style="color:#000000;" translate="true">Можно так же делать каскадирование </text><text style="font-family:Consolas; font-size:10pt; font-weight:bold; color:#000080;" translate="true">ON UPDATE CASCADE </text><text styleclass="Normal" style="color:#000000;" translate="true">и т.д.</text></para>
  </body>
</topic>
