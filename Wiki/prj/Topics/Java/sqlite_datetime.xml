<?xml version="1.0" encoding="UTF-8"?>
<topic template="Default" lasteditedby="Kot" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../helpproject.xsd">
  <title translate="true">Работа с датой и временем</title>
  <body>
    <header>
      <para styleclass="Heading1"><text styleclass="Heading1" translate="true">Работа с датой и временем</text></para>
    </header>
    <para styleclass="Normal" style="text-indent:37px; margin-right:0px; margin-left:0px; tabstops:none;"><text styleclass="Normal" translate="true">Итак, как же работать с датами в SQLite в коде android?</text><br/><text styleclass="Normal" translate="true">Обратимся к документации SQLite - открываем ссылку и листаем до пункта 1.2 Date and Time Datatype и видим - SQLite не поддерживает дату в нормальном виде!</text><br/><text styleclass="Normal" translate="true">Вот откуда растут ноги -  дату предлагают хранить в 3-х форматах:</text><br/></para>
    <list id="34" type="ol" listtype="decimal" formatstring="&#37;&#115;&#46;" format-charset="DEFAULT_CHARSET" levelreset="true" legalstyle="false" startfrom="1" styleclass="Normal" style="text-indent:37px; margin-right:0px; margin-left:0px; tabstops:none; font-family:&apos;Times New Roman&apos;; font-size:14pt; color:#000000;">
      <li styleclass="Normal" style="text-indent:37px; margin-right:0px; margin-left:0px; tabstops:none;"><text styleclass="Normal" translate="true">Текст (</text><text styleclass="Normal" style="color:#0080ff;" translate="true">TEXT</text><text styleclass="Normal" translate="true">) в формате ISO8601 который записывается вот так: (&quot;YYYY-MM-DD HH:MM:SS.SSS&quot;)</text></li>
      <li styleclass="Normal" style="text-indent:37px; margin-right:0px; margin-left:0px; tabstops:none;"><text styleclass="Normal" translate="true">Дробное (</text><text styleclass="Normal" style="color:#0080ff;" translate="true">REAL</text><text styleclass="Normal" translate="true">) как количество дней юлианского календаря с полудня 24 ноября 4714 до Н.Э. по Гринвичу</text></li>
      <li styleclass="Normal" style="text-indent:37px; margin-right:0px; margin-left:0px; tabstops:none;"><text styleclass="Normal" translate="true">Целое (</text><text styleclass="Normal" style="color:#0080ff;" translate="true">INTEGER</text><text styleclass="Normal" translate="true">) в формате Unix Time, который представляет из себя количество секунд с  1970-01-01 00:00:00 UTC</text></li>
    </list>
    <para styleclass="Normal" style="text-indent:37px; margin-right:0px; margin-left:0px; tabstops:none;"></para>
    <para styleclass="Normal" style="text-indent:37px; margin-right:0px; margin-left:0px; tabstops:none;"><text styleclass="Normal" translate="true">Пройдемся по предложенным вариантам:</text><br/></para>
    <list id="35" type="ol" listtype="decimal" formatstring="&#37;&#115;&#46;" format-charset="DEFAULT_CHARSET" levelreset="true" legalstyle="false" startfrom="1" styleclass="Normal" style="text-indent:37px; margin-right:0px; margin-left:0px; tabstops:none; font-family:&apos;Times New Roman&apos;; font-size:14pt; color:#000000;">
      <li styleclass="Normal" style="text-indent:37px; margin-right:0px; margin-left:0px; tabstops:none;"><text styleclass="Normal" translate="true">В принципе неплохое решение, если нужно вручную просматривать и править БД, в отличие от остальных форматов человек сможет поправить такое число сам. Но есть и обратная сторона медали: Строки занимают огромное - непозволительное количество места, что черевато на маломощных устройствах. Плюс к тому обработка строк происходит довольно медленно по тем же причинам. Лично я не собираюсь редактировать данные на устройстве пользователя вручную, считаю этот вариант негодным для андроида.</text></li>
      <li styleclass="Normal" style="text-indent:37px; margin-right:0px; margin-left:0px; tabstops:none;"><text styleclass="Normal" translate="true">Очень замысловатое решение, кроме того дробные числа так же не особо быстро работают на мобильных устройствах. Отбросим и его.</text></li>
      <li styleclass="Normal" style="text-indent:37px; margin-right:0px; margin-left:0px; tabstops:none;"><text styleclass="Normal" translate="true"> По моему самый подходящий вариант решения проблемы. Целые числа занимают мало места, быстро обрабатываются, кроме того в java.sql.Date есть методы по обработке таких чисел. Но методы java.sql.Date работают с датой в формате мили секунд, поэтому, для того чтобы не переводить данные туда-сюда-обратно предлагаю использовать тип LONG (Скажу по секрету разработчики андроид </text><text styleclass="Normal" translate="true">так</text><text styleclass="Normal" translate="true"> и делают, хотя тип INTEGER в SQLite прекрасно вмещает Java&apos;вский Long).  На этом методе и остановимся подробно.</text></li>
    </list>
    <para styleclass="Normal" style="text-indent:37px; margin-right:0px; margin-left:0px; tabstops:none;"></para>
    <para styleclass="Normal" style="text-indent:37px; margin-right:0px; margin-left:0px; tabstops:none;"><text styleclass="Normal" style="font-weight:bold;" translate="true">Как</text><text styleclass="Normal" translate="true"> объявить дату в таблице?</text><br/><text styleclass="Normal" translate="true">Просто - создаем поле типа LONG</text><br/></para>
    <para styleclass="Normal" style="text-indent:37px; margin-right:0px; margin-left:0px; tabstops:none;"><text styleclass="Normal" style="font-weight:bold;" translate="true">Как</text><text styleclass="Normal" translate="true"> записывать дату в поле БД из кода?</text><br/><text styleclass="Normal" translate="true">Достаточно преобразовать дату в нужный формат функцией .getTime(), которая есть практически у каждого типа дат в Java</text><br/><text styleclass="Normal" translate="true">Например так:</text><br/></para>
    <para styleclass="Normal" style="text-indent:37px; margin-right:0px; margin-left:0px; tabstops:none;"><text styleclass="Normal" translate="true">db.execSQL(&quot;INSERT INTO TableName (Date) VALUES (&quot; + (new java.util.Date()).getTime() + &quot;);&quot;);</text></para>
    <para styleclass="Normal" style="text-indent:37px; margin-right:0px; margin-left:0px; tabstops:none;"></para>
    <para styleclass="Normal" style="text-indent:37px; margin-right:0px; margin-left:0px; tabstops:none;"><text styleclass="Normal" style="font-weight:bold;" translate="true">Как</text><text styleclass="Normal" translate="true"> использовать дату из типа LONG полученную из таблицы?</text><br/><text styleclass="Normal" translate="true">Класс java.sql.Date содержит конструктор, который как раз и принимает дату в нужном нам формате. то есть, чтобы преобразовать переменную recivedSQLiteData тз типа Long применяем следующую конструкцию:</text><text styleclass="Normal" translate="true"> </text><br/></para>
    <para styleclass="Normal" style="text-indent:37px; margin-right:0px; margin-left:0px; tabstops:none;"><text styleclass="Normal" translate="true">java.sql.Date dt = new java.sql.Date(recivedSQLiteData);</text></para>
    <para styleclass="Normal" style="text-indent:37px; margin-right:0px; margin-left:0px; tabstops:none;"><text styleclass="Normal" translate="true">После этого полученную переменную уже можно приводить к необходимому типу данных.</text></para>
    <para styleclass="Normal" style="text-indent:37px; margin-right:0px; margin-left:0px; tabstops:none;"></para>
    <para styleclass="Normal" style="text-indent:37px; margin-right:0px; margin-left:0px; tabstops:none;"><text styleclass="Normal" style="color:#0000ff;" translate="true">С часовыми поясами все просто</text><text styleclass="Normal" translate="true"> - самый правильный вариант хранить все даты и время в GMT, а часовые пояса хранить в отдельном столбце в виде INTEGER, тогда, например можно для разных пользователь показывать время в их родном часовом поясе.</text></para>
    <para styleclass="Normal" style="text-indent:37px; margin-right:0px; margin-left:0px; tabstops:none;"></para>
    <para styleclass="Normal" style="text-indent:37px; margin-right:0px; margin-left:0px; tabstops:none;"><text styleclass="Normal" style="color:#0000ff;" translate="true">Как на счет такого</text><text styleclass="Normal" translate="true">, допустим у нас </text><text styleclass="Normal" style="color:#ff0000;" translate="true">дата хранится в базе в LONG и нам нужно выбрать поля с определенной датой</text><text styleclass="Normal" translate="true"> (например сегодня)?</text></para>
    <para styleclass="Normal" style="text-indent:0px; margin-right:0px; margin-left:0px; tabstops:none;"><text styleclass="Normal" translate="true">Можно найти значение Unix Time для сегодня 0:00 и для завтра 0:00 (GregorianCalendar должен помочь) и сделать SQL-запрос с BETWEEN.</text></para>
    <para styleclass="Normal" style="text-indent:37px; margin-right:0px; margin-left:0px; tabstops:none;"></para>
  </body>
</topic>
