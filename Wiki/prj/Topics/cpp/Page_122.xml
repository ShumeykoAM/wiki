<?xml version="1.0" encoding="UTF-8"?>
<topic template="Default" lasteditedby="Kot" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="helpproject.xsd">
  <title translate="true">Переменное число параметров</title>
  <body>
    <header>
      <para style="margin-bottom:2px; margin-left:4px;"><anchor id="hdr" styleclass="Heading1"></anchor><text style="font-family:Verdana; font-size:10pt; font-weight:bold; color:#000000;" translate="true">Переменное число параметров</text></para>
    </header>
    <para><table rowcount="1" colcount="1" style="width:100%; cell-padding:1px; cell-spacing:0px; page-break-inside:auto; border-width:0px; border-spacing:0px; border-collapse:collapse; cell-border-width:0px; border-style:none; background-color:#99ccff; head-row-background-color:none; alt-row-background-color:none;">
      <tr style="vertical-align:top">
        <td style="vertical-align:middle;">
          <para><anchor id="hdr" style="font-family:Arial; font-size:10pt; color:#000000;"></anchor><text style="font-family:Verdana; font-size:8pt; font-style:italic; color:#000000;" translate="true">C++ Бъерн Страуструп</text></para>
        </td>
      </tr>
    </table></para>
    <para styleclass="Normal" style="margin-top:6px; margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">Язык C++ вслед за С позволяет писать функции с переменным числом параметров. Одним из простых примеров может служить функция, вычисляющая среднее арифметическое своих аргументов. Другой уже классический пример — функция сцепления произвольного количества строк, которая является естественным обобщением функции сцепления двух строк.</text><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">&#32;</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">Переменный список параметров задается в заголовке функции многоточием:</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">int f(…)</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">Этот заголовок не вызывает у компилятора протестов. Такая запись означает, что при определении функции компилятору неизвестны ни количество параметров, ни их типы, и он, естественно, не может ничего проверить. Количество параметров и их типы становятся известными только при вызове функции.</text><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">&#32;</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">Однако у программиста с написанием таких функций сразу возникают проблемы. Ведь имена параметров отсутствуют! Поэтому доступ можно осуществить только одним способом – косвенным, используя указатель. Вспомним, что все параметры при вызове помещаются в стек. Если мы каким-то образом установим указатель на начало списка параметров в стеке, то, манипулируя с указателем, мы, в принципе, можем «достать» все параметры!</text><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">&#32;</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">Таким образом, список параметров совсем пустой быть не может, должен быть прописан хотя бы один явный параметр, адрес которого мы можем получить при выполнении программы. Заголовок такой функции может выглядеть так:</text><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">&#32;</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">int f(int k...)</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">Ни запятая, ни пробел после параметра не обязательны, хотя можно их и прописать.</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">Есть одно обстоятельство, которое ограничивает применение таких функций: при написании функции с переменным числом параметров помимо алгоритма обработки программист должен разрабатывать и алгоритм доступа к параметрам. Так что список необъявленных параметров не может быть совсем уж произвольным – в языке C++ не существует универсальных средств распознавания элементов этого списка. Это же означает, что передача аргумента не того типа, который задумывался, или не тем способом, который подразумевался при разработке, приведет к катастрофическим последствиям – компилятор-то ничего не проверяет.</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">Попробуем написать функцию, вычисляющую среднее арифметическое своих аргументов. Для этого требуется решить несколько проблем</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">как установиться на список параметров в стеке;</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">как «перебирать» параметры;</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">как закончить перебор.</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">Для доступа к списку параметров нам потребуется указатель, значением которого будет адрес последнего явного параметра в списке. Ответ на второй вопрос очевиден – надо изменять значение этого указателя, чтобы переместиться на следующий параметр. Отсюда следует, что указатель должен быть типизированным, поскольку с бестиповым указателем нельзя выполнять арифметические операции. Это же означает, что программист при разработке функции с переменным числом параметров должен отчетливо себе представлять типы аргументов, которые будет обрабатывать функция. Кроме того, способ передачи параметров должен быть одинаковым для всех параметров: либо все – по значению, либо все – по ссылке, либо все – по указателю.</text><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">&#32;</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">Ответ на последний вопрос не вызывает затруднений. Это можно сделать одним из двух способов:</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">явно передать среди обязательных параметров количество аргументов;</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">добавить в конец списка аргумент с уникальным значением, по которому будет определяться конец списка параметров;</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">И тот, и другой способ имеют право на жизнь — все определяется потребностями задачи и вкусами программиста. В данном случае сначала попробуем второй способ: последним значением списка параметров будет ноль (листинг 7.7).</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">Листинг 7.7. Вычисление среднего арифметического аргументов (ноль в конце)</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><table rowcount="1" colcount="1" style="width:96%; cell-padding:1px; cell-spacing:2px; page-break-inside:auto; border-width:0px; border-spacing:2px; cell-border-width:0px; border-style:none; background-color:#ffffe7; head-row-background-color:none; alt-row-background-color:none;">
      <tr style="vertical-align:top">
        <td style="vertical-align:middle; background-color:#eeeeee;">
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">double</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> f(</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">double</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> n, ...) &#160; &#160;</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#008000;" translate="true">//--заголовок с переменным числом параметров</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true">{ &#160; </text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">double</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> *p = &amp;n; &#160; &#160; &#160; &#160;</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#008000;" translate="true">//--установились на начало списка параметров</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; &#160;</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">double</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> sum = 0, count = 0;</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; &#160;</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">while</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> (*p) &#160; &#160; &#160; &#160; </text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#008000;" translate="true">//--пока аргумент не равен нулю</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; &#160;{ sum+=(*p); &#160; &#160; &#160; &#160; </text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#008000;" translate="true">//--суммируем аргумент</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; &#160; &#160;p++; &#160; &#160; &#160; &#160; &#160; &#160; </text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#008000;" translate="true">//--«перемещаемся на следующий аргумент</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; &#160; &#160;count++; &#160; &#160; &#160; &#160; </text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#008000;" translate="true">//--считаем &#160;количество аргументов</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; &#160;}</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; &#160;</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">return</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> ((sum)?sum/count:0); &#160; &#160;</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#008000;" translate="true">//--вычисляем среднее</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true">}</text></para>
        </td>
      </tr>
    </table></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">Вызов такой функции может выглядеть таким образом:</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">double y = f(1.0, 2.0, 3.0, 4.0, 0.0);</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">Переменная y получит значение 2.5. Так как компилятор ничего не проверяет, то попытка вызвать такую функцию с целыми аргументами f(1,2,3,0) либо вызовет аварийный останов программы (это лучший вариант), либо в приводит к неверному (но правдоподобному — в этом главная опасность) результату.</text><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">&#32;</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">Реализация функции, которая в качестве первого параметра получает количество аргументов, на первый взгляд, не вызывает затруднений. Однако, если первый аргумент – целое число, то требуется преобразование указателя. И тут не все варианты проходят. Не будет работать такой вариант:</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><table rowcount="1" colcount="1" style="width:96%; cell-padding:1px; cell-spacing:2px; page-break-inside:auto; border-width:0px; border-spacing:2px; cell-border-width:0px; border-style:none; background-color:#ffffe7; head-row-background-color:none; alt-row-background-color:none;">
      <tr style="vertical-align:top">
        <td style="vertical-align:middle; background-color:#eeeeee;">
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">double</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> f(</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">int</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> n, ...) &#160; &#160; &#160; &#160; &#160; &#160;</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#008000;" translate="true">//--количество элементов</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true">{ &#160; </text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">int</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> *p = &amp;n; &#160; &#160; &#160; &#160; &#160; &#160;</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#008000;" translate="true">//--указатель – «целый»</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; &#160;</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">double</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> sum = 0, count = n;</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; &#160;</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">for</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> (;n--;(</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">double</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true">*)p++) &#160; &#160; &#160; &#160; </text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#008000;" translate="true">//--преобразование int* -&gt;double*</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; &#160; &#160;sum+=(*p);</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; &#160;</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">return</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> ((sum)?sum/count:0);</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true">}</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#008000;" translate="true">//Такой вариант тоже неработоспособен</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">double</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> f(</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">int</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> n, ...) &#160; &#160; &#160; &#160; &#160; &#160;</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#008000;" translate="true">//--количество элементов</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true">{ &#160; </text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">double</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> *p = (</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">double</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> *)&amp;n; &#160; &#160;</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#008000;" translate="true">//--преобразование адреса</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; &#160;</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">double</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> sum = 0, count = n;</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; &#160;</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">for</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> (;n--;p++) &#160; &#160; &#160; &#160; &#160; &#160; </text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#008000;" translate="true">//--изменение указателя</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; &#160; &#160;sum+=(*p);</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; &#160;</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">return</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> ((sum)?sum/count:0);</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true">}</text></para>
        </td>
      </tr>
    </table></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">Причина кроется в том, что изменение указателя производится на столько байт, сколько в памяти занимает базовый тип. В обоих случаях мы установились не на начало списка double-параметров, а на sizeof(int) байтов «раньше» — на целую переменную. И от этого адреса происходит изменение указателя на 8 байт (sizeof(double)), что приводит к совершенно неверным результатам. Решение заключается в том, чтобы сначала изменить «целый» указатель, а потом уже его преобразовать в double *. Так всегда необходимо делать, если тип первого параметра отличается от типов отсутствующих параметров (листинг 7.8).</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">Листинг 7.8. Вычисление среднего арифметического аргументов (количество)</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><table rowcount="1" colcount="1" style="width:96%; cell-padding:1px; cell-spacing:2px; page-break-inside:auto; border-width:0px; border-spacing:2px; cell-border-width:0px; border-style:none; background-color:#ffffe7; head-row-background-color:none; alt-row-background-color:none;">
      <tr style="vertical-align:top">
        <td style="vertical-align:middle; background-color:#eeeeee;">
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">double</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> f(</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">int</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> n, ...) &#160; &#160; &#160; &#160; &#160; &#160;</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#008000;" translate="true">//--количество элементов</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true">{ &#160;</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">int</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> *p = &amp;n;</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; &#160;p++; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#008000;" translate="true">//-3-установка «целого» на double</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; &#160;</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">double</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> *pp = (</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">double</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> *)p; &#160; &#160;</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#008000;" translate="true">//--преобразование типа указателя</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; &#160;</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">double</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> sum = 0, count = n;</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; &#160;</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">for</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> (;n--;pp++) &#160; &#160; &#160; &#160; &#160; &#160; </text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#008000;" translate="true">//--правильное увеличение на 8</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; &#160; &#160; sum+=(*pp);</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; &#160;</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">return</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> ((sum)?sum/count:0);</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true">}</text></para>
        </td>
      </tr>
    </table></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">В строке //-3- операция p++ устанавливает указатель на первый элемент списка параметров типа double. Для дальнейшего изменения указателя на 8 мы использовали преобразование типа указателя:</text><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">&#32;</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">double *pp = (double *)p;</text><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">&#32;</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">После этой строки операция pp++ будет увеличивать указатель на sizeof(double)=8, что нам и требуется.</text><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">&#32;</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">Мы использовали способ передачи параметров по значению. В этом случае в качестве фактических аргументов можно задавать произвольные выражения. Однако можно использовать и передачу ссылки – это несколько осложняет вызов, поскольку в этом случае в списке аргументов могут прописываться только переменные. Необходимо также помнить, что все фактические аргументы должны передаваться одинаковым способом. Тогда прототип первого варианта функции выглядит так (тело функции не изменяется):</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">double f(double &amp;n, ...)</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">При вызове можно использовать элементы массива:</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">double m[] = {1.0,2.0,3.0,4.0,0.0};</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">cout &lt;&lt;f(m[0],m[1],m[2],m[3],m[4])&lt;&lt;endl;</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">Эта программа выведет на экран 2.5.</text><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">&#32;</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">Язык C++ в качестве элементов переменного списка аргументов разрешает прописывать указатели. Однако обработка такого варианта вызывает сложности – нам требуется двойной косвенный доступ, а указатель для доступа к стеку — «одноразовый». Таким образом, если передавать параметры-указатели, то в приведенной выше программе (с первым параметром-количеством) значение *рр – это не число типа double, а адрес этого числа. Тут без «обмана» компилятора не обойтись, поскольку он просто так не пропускает преобразование «одноразовой» косвенности в двойную. Но мы помним, что все типизированные указатели, независимо от типа и косвенности всегда представляют собой адрес, размер которого в Intel – 4 байта. Тогда можно использовать union (листинг 7.9).</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">Листинг 7.9. Переменный список параметров-указателей (количество)</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><table rowcount="1" colcount="1" style="width:96%; cell-padding:1px; cell-spacing:2px; page-break-inside:auto; border-width:0px; border-spacing:2px; cell-border-width:0px; border-style:none; background-color:#ffffe7; head-row-background-color:none; alt-row-background-color:none;">
      <tr style="vertical-align:top">
        <td style="vertical-align:middle; background-color:#eeeeee;">
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">double</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> f(</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">int</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> n, ...)</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true">{ &#160;</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">int</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> *p = &amp;n; &#160; &#160; &#160; &#160;</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#008000;" translate="true">//--«одноразовый» указатель</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; &#160;p++; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#008000;" translate="true">//--«достаем» список параметровd-указателей</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; </text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">union</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> Pointer</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; {</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">double</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> **pp; </text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">double</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> *kp; }; &#160; &#160;</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#008000;" translate="true">//--«подстава» указателей</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; &#160;Pointer A;</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; &#160;A.kp = (</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">double</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> *)p; &#160; &#160; &#160; &#160; &#160; </text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#008000;" translate="true">//-«обманываем» компилятора</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; &#160;</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">double</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> sum = 0, count = n;</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; &#160;</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">for</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> (;n--;A.pp++) &#160; &#160; &#160; &#160; </text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#008000;" translate="true">//--изменяем двойной указатель!</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; &#160; &#160; &#160; sum+=(**A.pp); &#160; &#160; &#160; &#160; </text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#008000;" translate="true">//--двойной доступ!</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; &#160;</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">return</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> ((sum)?sum/count:0);</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true">}</text></para>
        </td>
      </tr>
    </table></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">Хотя по стандарту такое использование union означает undefined behaviour (неопределенное поведение), и непереносимо, но на практике (например, на платформе Intel) работает хорошо. Однако при переносе на другую платформу надо будет проверять корректность работы такой функции.</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">Необходимо обратить внимание на то, что изменяем мы «двойной» указатель – «одноразовый» использовать нельзя, поскольку будет изменение на sizeof(double)=8 байт, а нам требуется изменение на sizeof(double*)= 4 байта. И при суммировании используется двойной косвенный доступ. Обращение к такой функции выполняется так:</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">cout &lt;&lt;f(2,&amp;a,&amp;b)&lt;&lt;endl;</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">Аналогичная функция без счетчика аргументов может использовать в качестве признака окончания списка параметров нулевой указатель. Но в данном случае «обманывать» компилятор не требуется — в функции непосредственно используется «двойной» указатель (листинг 7.10).</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">Листинг 7.10. Переменный список параметров-указателей (ноль в конце)</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><table rowcount="1" colcount="1" style="width:96%; cell-padding:1px; cell-spacing:2px; page-break-inside:auto; border-width:0px; border-spacing:2px; cell-border-width:0px; border-style:none; background-color:#ffffe7; head-row-background-color:none; alt-row-background-color:none;">
      <tr style="vertical-align:top">
        <td style="vertical-align:middle; background-color:#eeeeee;">
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">double</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> f(</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">double</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> *a, ...)</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true">{ &#160; </text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">double</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> **p = &amp;a; &#160; &#160; &#160; &#160; </text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#008000;" translate="true">//--берем адрес-адреса</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; &#160;</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">double</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> sum = 0, count = 0;</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; &#160;</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">while</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> (*p!=0) &#160; &#160; &#160; &#160; </text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#008000;" translate="true">//-- NULL – прямо в списке параметров</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; &#160;{ sum+=(**p); &#160; &#160; &#160; &#160; </text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#008000;" translate="true">//--выбираем значения</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; &#160; &#160; count++; p++; &#160; &#160; &#160; &#160;</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#008000;" translate="true">//--бежим по списку</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; &#160;}</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; &#160;</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">return</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> ((sum)?sum/count:0);</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true">}</text></para>
        </td>
      </tr>
    </table></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">Вызов такой функции выглядит так:</text><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">&#32;</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">f(&amp;a,&amp;b,0)</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">Особо обратите внимание на следующее: в списке параметров 0 – это значение, а не адрес. Поэтому в теле функции проверка окончания цикла делается с одной звездочкой, а не с двумя.</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">Напоследок осталось рассмотреть пример, в котором список указателей переменной длины составляют указатели на char. Мы выделяем этот случай по двум причинам:</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">размер данных (char) меньше, чем размер указателя (char*) – в остальных случаях размер данных больше или равен размеру указателя;</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">char* — это единственный указатель, вместо которого при вызове можно задавать не адрес.</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">Типичной функцией, в которой можно применить переменный список параметров, является функция сцепления произвольного количества строк в одну. Заголовок такой функции может выглядеть так:</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">char *f(char *s1, ...)</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">Функция должна сначала вычислить количество памяти, необходимой для целевой строки, а потом уже помещать туда результат сцепления. Используем тот же прием, что и в предыдущем примере – последний параметр должен быть 0 (листинг 7.11).</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">Листинг 7.11. Сцепление строк (ноль в конце)</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><table rowcount="1" colcount="1" style="width:96%; cell-padding:1px; cell-spacing:2px; page-break-inside:auto; border-width:0px; border-spacing:2px; cell-border-width:0px; border-style:none; background-color:#ffffe7; head-row-background-color:none; alt-row-background-color:none;">
      <tr style="vertical-align:top">
        <td style="vertical-align:middle; background-color:#eeeeee;">
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">char</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> *f(</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">char</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> *s1, ...)</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true">{ </text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">char</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> **cp = &amp;s1; &#160; &#160; &#160; &#160; &#160; &#160;</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#008000;" translate="true">//--адрес первого указателя</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; </text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">int</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> len = 0;</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; </text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#008000;" translate="true">// цикл для определения общей длины сцепляемых строк</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; </text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">while</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> (*cp) { len += strlen(*cp); cp++; }</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160;</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">char</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> *s = </text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">new char</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true">[len+1]; &#160; &#160; &#160; </text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#008000;" translate="true">//--память для строки</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160;s[0]=0; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#008000;" translate="true">//-- &quot;очищаем&quot; строку</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#008000;" translate="true">// цикл для сцепления строк</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160;cp=&amp;s1; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#008000;" translate="true">//-- опять установка на 1-й параметр</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160;</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">while</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> (*cp)</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160;{ &#160;strcat(s, *cp); &#160; &#160; &#160; &#160; &#160; &#160; </text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#008000;" translate="true">//-- прицепляем первую (и следующие)</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; &#160; cp++; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; </text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#008000;" translate="true">//-- перемещаемся на следующую</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160;}</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160;</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">return</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> s;</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true">}</text></para>
        </td>
      </tr>
    </table></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">Вызов такой функции может быть таким</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">char *ss = f(s1, s2, s3, 0);</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">где s1, s2, s3 – это либо объявленные константы, либо переменные типа char *. Ту же функцию можно вызывать и с явно прописанными константами:</text><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">&#32;</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">char *sd = f(“First “,“Two “,“Three “, 0);</text><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">&#32;</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">Очевидно, вместо параметра-указателя (ссылки) можно подставлять выражение, имеющее результатом указатель (ссылку). В частности, на месте указателя на char можно вызвать функцию, которая вводит строку с клавиатуры.</text><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">&#32;</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">Стандартные средства</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">В стандарт языка входит набор макросов для работы со списками параметров переменной длины, определенный в stdarg.h. При их использовании точно так же требуется указывать в списке явный параметр, объявить и установить на него указатель и перемещаться по списку, изменяя его. В конце списка должен стоять NULL. Макросы, обеспечивающие стандартный доступ к спискам параметров переменной длины, имеют следующий формат:</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">void va_start(va_list prm, последний-явный-параметр);</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">тип va_arg(va_list prm, тип);</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">void va_end(va_list prm);</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">Тип указателя определяется с помощью оператора typedef как va_list. Макрос va_start устанавливает указатель типа va_list на явный параметр, макрос va_arg перемещает указатель на следующий параметр, а макрос va_end обнуляет указатель. Указанные макросы используются следующим образом:</text><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">&#32;</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">1. в теле функции с переменным числом параметров до первого использования указанных макросов должно появиться объявление объекта типа va_list, например va_list LastP; фактически это является объявлением указателя;</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">2. указанный объект связывается с последним явным параметром (перед многоточием) переменного списка параметров с помощью макроса va_start, например va_start(LastP,P); таким образом происходит инициализация указателя;</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">3. передвижение по переменному списку параметров выполняется макросом va_arg. Для этого, как указано выше, тоже необходимо явно указывать тип очередного параметра, то есть программист должен его знать в момент написания программы. Если все параметры в списке целого типа, то вызов va_arg выглядит так: va_arg(LastP,int);</text><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">&#32;</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">4. после всей обработки ставится вызов va_end, например va_end(LastP).</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">В качестве примера рассмотрим реализацию функции вычисления среднего арифметического (вариант с количеством аргументов) с использованием этих макросов (листинг 7.12).</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">Листинг 7.12. Вычисление среднего с использование стандартных средств (количество)</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><table rowcount="1" colcount="1" style="width:96%; cell-padding:1px; cell-spacing:2px; page-break-inside:auto; border-width:0px; border-spacing:2px; cell-border-width:0px; border-style:none; background-color:#ffffe7; head-row-background-color:none; alt-row-background-color:none;">
      <tr style="vertical-align:top">
        <td style="vertical-align:middle; background-color:#eeeeee;">
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">double</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> f(</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">int</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> n, </text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">double</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> a, ...)</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true">{ &#160; va_list p; &#160; &#160; &#160; &#160; &#160; &#160; </text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#008000;" translate="true">//--объявление указателя</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; &#160;</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">double</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> sum = 0, count = 0;</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; &#160;va_start(p, n); &#160; &#160; &#160; &#160; &#160; &#160;</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#008000;" translate="true">//--инициализация указателя</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; &#160;</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">while</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true">(n--)</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; &#160;{ sum+=va_arg(p,</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">double</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true">); &#160; &#160; &#160; &#160;</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#008000;" translate="true">//--перемещение указателя</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; &#160; &#160;count++;</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; &#160;}</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; &#160;va_end(p); &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#008000;" translate="true">//--«закрытие» указателя</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; &#160;</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">return</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> ((sum)?sum/count:0);</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true">}</text></para>
        </td>
      </tr>
    </table></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">Очень похоже выглядит и вариант с нулем в конце списка (листинг 7.13).</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">Листинг 7.13. Вычисление среднего стандартными средствами (ноль в конце)</text></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><table rowcount="1" colcount="1" style="width:96%; cell-padding:1px; cell-spacing:2px; page-break-inside:auto; border-width:0px; border-spacing:2px; cell-border-width:0px; border-style:none; background-color:#ffffe7; head-row-background-color:none; alt-row-background-color:none;">
      <tr style="vertical-align:top">
        <td style="vertical-align:middle; background-color:#eeeeee;">
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">double</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> f(</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">double</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> a, ...)</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true">{ &#160; va_list p; &#160; &#160; &#160; &#160; &#160; &#160; </text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#008000;" translate="true">//--объявление указателя</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; &#160;</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">double</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> sum = 0, count = 0;</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; &#160;va_start(p, a); &#160; &#160; &#160; &#160; &#160; &#160;</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#008000;" translate="true">//--инициализация указателя</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; &#160;</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">double</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> k = a; &#160; &#160; &#160; &#160; &#160; &#160;</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#008000;" translate="true">//--промежуточная переменная</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; &#160;</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">do</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> { sum+=k; &#160;count++;</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; &#160;} </text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">while</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true">(k=va_arg(p,</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">double</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true">)); &#160; &#160; </text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#008000;" translate="true">//--пока не ноль -передвигаемся</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; &#160;va_end(p); &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#008000;" translate="true">//--«закрыли» указатель</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> &#160; &#160;</text><text style="font-family:&apos;Courier New&apos;; font-size:9pt; color:#0000ff;" translate="true">return</text><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true"> ((sum)? sum/count: 0);</text></para>
          <para styleclass="Normal" style="margin-left:10px; line-height:1.0; white-space:nowrap; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:&apos;Courier New&apos;; font-size:9pt; text-decoration:none; vertical-align:baseline; color:#000066;" translate="true">}</text></para>
        </td>
      </tr>
    </table></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"></para>
    <para styleclass="Normal" style="margin-left:79px; line-height:1.0; page-break-after:auto; tabstops:none;"><text style="font-family:Verdana; font-size:12pt; color:#000000; background-color:#ffffe7;" translate="true">Однако в этом случае удобно использовать цикл do while, так как указатель p сразу устанавливается на слагаемое. Передвижение по списку выполняется прямо в условии цикла, что обеспечивает одновременную проверку на ноль.</text></para>
    <para><line style="height:1px; color:#999999;" /></para>
    <para styleclass="Normal" style="margin-top:10px; margin-bottom:6px; line-height:1.0; page-break-after:auto; tabstops:none;"><text styleclass="Normal" style="font-family:Verdana; font-size:8pt; font-style:italic; text-decoration:none; vertical-align:baseline; color:#000000;" translate="true"> Copyright ©2011 </text><text styleclass="Normal" style="font-family:Verdana; font-size:8pt; font-style:italic; text-decoration:none; vertical-align:baseline; color:#0000ff;" translate="true">C++</text><text styleclass="Normal" style="font-family:Verdana; font-size:8pt; font-style:italic; text-decoration:none; vertical-align:baseline; color:#000000;" translate="true">. All Rights Reserved.</text></para>
  </body>
</topic>
